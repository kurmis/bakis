\documentclass[a4paper, 12pt]{article} %--< dokumento nustatymai >--%
%\usepackage[T1]{fontenc} %--< reikia kuomet norima naudoti komanda \k{a} - a raide bus parasyta su nosine >--%
\usepackage{graphicx} %--< reikalinga paveiksliuku ikelimui >--%
\usepackage[left=1.18in,top=0.79in,right=0.39in,bottom=0.79in]{geometry} %--< parasciu nustatymai >--%
\usepackage{color} %--< spalvoto srifto nustatymai >--%
\usepackage{xcolor}
\usepackage{setspace} %--< setspace.sty failas turi buti toje pacioje direktorijoje kaip ir winedt failas >--%
\usepackage{caption} %--< leidzia rasyti komentarus po objektais >--%
\usepackage{cite} %-< reikalinga citavimui >--%
\usepackage{verbatim} %--< leidzia naudoti \begin{comment}...\end{comment} funkcijas>--%

\usepackage[utf8]{inputenc} %--< kad butu galima rasyti lietuviskai >--%
\usepackage[L7x]{fontenc}
\usepackage[lithuanian]{babel}
\usepackage{lmodern}

%\usepackage[english]{babel}
\usepackage{array}
\usepackage[titles]{tocloft}
\usepackage{amsmath} %--< formuliu rasymui >--%
\usepackage{indentfirst} %--< pirmas paragrafas prasideda su tab'u >--%
\usepackage{enumitem} %--< tarpu tarp eiluciu sarase redagavimui >--%
%\usepackage{numline} %--< eiluciu numeravimas, sio paketo naudojimas panaikina section pavadinimus >--%
\usepackage{xfrac}
\usepackage{float}
\usepackage{array}
\usepackage{multirow}
\usepackage[]{SIunits}


\makeatletter
\let\c@lofdepth\relax
\let\c@lotdepth\relax
\makeatother
\usepackage{subfigure}
%\usepackage{biblatex}

\setlength{\cftaftertoctitleskip}{-10pt}
\setlength{\cftbeforetoctitleskip}{-10pt}
%\setlength{\parskip}{6pt} %--< kiek tekstas nutoles nuo paragrafo pavadinimo >--%
\parindent=36pt %--< tab'o dydis 1 inch = 72 pt >--%

%-----------< kaip atrodo paveiksleliu ir lenteliu tesktas >-----------------%
\DeclareCaptionLabelFormat{numbfirst}{#2\bothIfSecond{\nobreakspace}{pav}} % -< paveiksliukai vadinami "pav" >- %
\DeclareCaptionLabelFormat{numbtwo}{#2\bothIfSecond{\nobreakspace}{lentel\.{e}}} % -< lenteles vadinamos "lentele" >- %
\DeclareCaptionLabelSeparator{tarpas}{. } % -< po pav taskas ir tarpas >- %
\captionsetup{justification=centering, font=normalsize, labelfont={}, textfont={it}}



%-----------------------------< keletas naudingu komandu >------------------------------------------%
\begin{comment}

-----< Lietuviskos raides, jei neveikia rasymas lietuviskai >--------
\k{a} = ą
\v{z} = ž
\v{s} = š
\.{e} = ė 
\k{e} = ę
\={u} = ū
\k{u} = ų
\k{i} = į
\v{c} = č
----------------------------------------

\textbf{padaro teksta bold}
\textit{Padaro teksta italic}
%\cite{ka cituojam}
\newpage naujas puslapis

Jei norim tekste formuliu rasom ja tarp $formule$, jei numeruotai, tai pagal
\begin{equation}
formule
label{formules_label}
\end{equation}
ir naudojam formules citavimui \ref{formule_label}

\noindent pritaukia eilute prie krasto

-------< paveiksliukams patogu susikurti atskira folderi takim paveiksliukai ar pav >--------
-------< vienas paveiksliukas >---------
\begin{figure}[H] %--< nustatymai kur bus paveiksliukas h - kaip tekste, t - puslapio virsuje, b - puslapio apacioje, H - tiksliai kaip tekste, p - atskiram paveiksleliu pslapy >--%
\centering %--< lygiavimas >--%
\includegraphics[scale=0.44]{pav/SPP_dispersijos_kreive} %--< scale - dydis, {aplankas/pav.pavadinimas} >--%
\captionsetup{labelformat=numbfirst} %--< pries tai apibrezem kaip turi atrodyti tekstas po paveiksleliu >--%
 \captionsetup{labelseparator=tarpas}
 \caption{Tesktas po paveiksleliu}
 \label{vienas}
 \end{figure}

-------< du paveiksliukai ir t.t. >---------
\begin{figure}[h]
\centering
\subfigure[]{ %--< pirmas paveiksliukas, jei [] tusti tai numeruojama raidemis >--%
\includegraphics[scale=0.3]{pav/pirmas}
\label{pirmas}
}
\centering
\subfigure[]{ %--< antras paveiksliukas >--%
\includegraphics[scale=0.27]{antras}
 \label{antras}
 }
\captionsetup{labelformat=numbfirst}
\captionsetup{labelseparator=tarpas}
\caption{Kas paveikslikuose (a) ir (b), tesktas po paveiksliuku}
\label{dupaveiksliukai}
\end{figure}

----------< numeruojam teksta >-------
\begin{enumerate}[itemsep=12pt, parsep=-10pt]
 \item[a)]  %--< jei [] nieko arba be [], tai numeruos skaiciais
\item[b)] 
\item[c)]      
\end{enumerate}

\end{comment}

%=================================================================%
%--< dalis kuria reikia uzpildyti, bet tam tikrais atvejais gali tekti pagal poreikius paredaguoti title.tex faila >--%
%=================================================================%

\newcommand{\studentas}{Mindaugas Kurmauskas} %--< cia irasyti savo varda pavarde (toliau kitus duomenis) ir nebereikes tekste >--%
\newcommand{\vadovas}{dr. Mindaugas Vil\={u}nas}
\newcommand{\recenzentas}{dr. Recenzentas}
\newcommand{\vedejas}{dr.(HP) K\k{e}stutis Arlauskas}
\newcommand{\pavadinimas}{Cortex R4 mikrovaldiklio architekt\={u}ros tyrimas} %--< cia irasyti darbo pavadinima >--%

\newcommand{\katedra}{\kkek} %--< irasyti savo, nebutinai komanda >--%
%=======%
\newcommand{\kkek}{Kieto k\={u}no elektronikos katedra}
\newcommand{\kek}{Kvantin\.{e}s elektronikos katedra}
\newcommand{\pfk}{Puslaidininki\k{u} fizikos katedra}
\newcommand{\rfk}{Radiofizikos katedra}
\newcommand{\tfk}{Teorin\.{e}s fizikos katedra}
\newcommand{\bfsk}{Bendrosios fizikos ir spektroskopijos katedra}
%==========%

\newcommand{\darbas}{\bakikurs} %--< irasyti savo >--%
%=========%
\newcommand{\bakikurs}{Pagrindini\k{u} studij\k{u} kursinis darbas}
\newcommand{\bakis}{Pagrindini\k{u} studij\k{u} baigiamasis darbas}
\newcommand{\magikurs}{Magistrant\={u}ros studij\k{u} kursinis darbas}
\newcommand{\magis}{Magistrant\={u}ros studij\k{u} baigiamasis darbas}
%==========%

\newcommand{\studprog}{\tf} %--< irasyti savo, nebutinai komanda >--%
%==========%
%--< besimokantiems fizfake studiju programos >--%
\newcommand{\fiz}{Fizika}
\newcommand{\tf}{Taikomoji fizika}
\newcommand{\tfe}{Telekomunikacij\={u} fizika ir elektronika}
\newcommand{\kf}{Kompiuterin\.{e} fizika}
\newcommand{\mtfv}{Moderni\k{u}j\k{u} technologij\k{u} fizika ir vadyba}
\newcommand{\bef}{Branduolin\.{e}s energetikos fizika}
\newcommand{\apchef}{Aplinkos ir chemin\.{e} fizika}
\newcommand{\bio}{Biofizika}
\newcommand{\laztech}{Lazerin\.{e}s technologijos}
\newcommand{\fiztech}{Fizikin\.{e}s technologijos ir j\k{u} vadyba}
\newcommand{\lazfiz}{Lazerin\.{e} fizika ir optin\.{e}s technologijos}
\newcommand{\mpf}{Med\v{z}iagotyra ir puslaidininki\k{u} fizika}
\newcommand{\optel}{Optoelektronikos med\v{z}iagos ir technologijos}
\newcommand{\tfem}{Telekomunikacij\k{u} fizika ir elektronika}
\newcommand{\tfa}{Teorin\.{e} fizika ir astrofizika}
%=================================================================%
%=================================================================%


%--------------------------------------< nuo cia prasideda dokumento tekstas >-------------------------------------%


\begin{document} % visas tekstas turi buti tarp begin{document} ir end{document} komandu


\input{./title.tex} % itraukiam titulini lapa i visa dokumenta

\newpage

\pagenumbering{arabic}
\setcounter{page}{2} % nuo kurio skaitmens pradeda numeruoti puslapius

%\tocloftpagestyle{abbrv}
\renewcommand{\cftsecleader}{\cftdotfill{\cftdotsep}} % turinio isvaizdos koregavimas

\renewcommand{\multirowsetup}{\centering}

\renewcommand{\contentsname}{Turinys}
\renewcommand\refname{Literat\={u}ros s\k{a}ra\v{s}as} % pakeicia "references" i "literaturos sarasas"
\tableofcontents

\newpage

\begin{onehalfspacing}

\section*{\k{I}vadas} % * nurodo nenumeruoti sitos dalies

\addcontentsline{toc}{section}{\k{I}vadas} % prideda prie turinio

Egzistuoja daug u\v{z}duo\v{c}i\k{u} kurioms atlikti reikia didelio patikimumo. J\k{u} atlikimui papra\v{s}\v{c}iausiu atveju galima naudoti standartinius mikrovaldiklius, kombinuojant su programin\.emis gudryb\.emis. Tokiomis kaip WDT $($watchdog timer$)$, kurios pri\v{z}i\=uri pagrindin\k{e} program\k{a}, kad ji tinkamai atliktu savo darb\k{a}. Nuolatiniais testais patikrinti duomen\k{u} skai\v{c}iavimo patikimum\k{a}, pavyzd\v{z}iui atlikti algoritma du kartus ir tikrinti ar atsakymai sutampa. Daugeliu atveju visos papildomos priemon\.es u\v{z}tikrinti patikimum\k{a} prailgina duomen\k{u} skai\v{c}iavimo laik\k{a}. \\
\indent Sistemose kurioms reikalingas didelis patikimumas ir darbas realeame laike labai praver\v{c}ia sistemos dubliavimas su tikrinimo funkcijomis. Klaidos tikimyb\.e ne visais atvejais yra tolydi laike, taigi klaidos gali tuo pa\v{c}iu metu ivykti abiejose sistemose. Tokiu atveju naudinga, kai sistemos dirba pastumtos laike at\v{z}vilgiu viena kitos. \\
\indent Yra daug aplink\k{u} kur gali reik\.eti toki\k{u} sistem\k{u}. Pramonin\.es saugumo reikalaujan\v{c}ios aplinkos, tokios kaip:
\begin{itemize}
\item automobil\k{u} stabdymo sistemos, tokios kaip rat\k{u} anti blokavimo sistema $($ABS$)$
\item elektros gaminimo ir paskirstymo sistemos.  
\item liftai ir eskalatoriai
\end{itemize}      
Medicinoje:
\begin{itemize}
\item defibriliatoriai
\item radiacijos terapija
\item robotizuotos operacijos
\end{itemize} 
\indent Atsi\v{z}velgiant \k{i} \v{s}\k{i} poreik\k{i} kompanija
 Teksas Instruments neseniai suk\={u}r\.e mikrovaldikli\k{u} \v{s}eim\k{a} 
 kodiniu pavadinimu Hercules. Mum kilo klausimas koks yra \v{s}i\k{u}
  mikrovaldikli\k{u} energetinis efektyvumas, k\k{a} \v{s}iame
   darba ir bandoma i\v{s}siai\v{s}kinti. \\
\indent Tolimesniame darbe b\=ut\k{u} idomu patikrinti veikim\k{a} esant ekstremaliam poveikui, galimyb\k{e} panaudoti vien\k{a} i\v{s} Hercules \v{s}eimos atstov\k{u} RM48 kosmose, kur jo u\v{z}duotis gal\.et\k{u} b\=uti navigacija, kur reikia slankaus formato ir skai\v{c}i\k{u} tikslumo.  

\newpage

\section{Naudojamos \k{i}rangos ir programos}
Naudojamas TMDXRM48USB maketas. Jame yra:
\begin{itemize}
\item Mikrovaldiklis xRM48L950AZWTT:
\begin{itemize}
\item Du 32-bitu ARM Cortex-R4F procesoriai, veikiantys kartu\footnote{lockstep - kartu atlieka tas pa\v{c}ias komandas}
\item 3MB flash, 256kB RAM
\item greitis iki 200MHz
\item neslankaus(32bitu) ir dvigubo tikslumo (64bitu) slankaus kablelio aritmetikos modulis
\end{itemize} 
\item Integruotas XDS100v2 emuliatorius programavimui per usb
\item LED'ai, temperat\=uros sensorius, \v{s}viesos sensorius, akselerometras
\item pro\v{z}ektoriukas
\end{itemize}
Palyginimui naudojamas STM32F4DISCOVERY maketas:
\begin{itemize}
\item mikrovaldiklis STM32F407VGT:
\begin{itemize}
\item 32-bitu ARM Cortex-M4F procesorius
\item 1MB flash, 192 kB RAM 
\item greitis iki 168MHz 
\item neslankaus (32bitu) ir slankaus (32bitu) kablelio aritmetikos modulis
\end{itemize}
\item Integruotas ST-LINK/V2 emuliatorius programavimui per usb
\item LED'ai, akselerometras, skaitmeninis mikrofonas
\item CS43L22- SAK garsui su integruotu D klases garso stiprinimu
\end{itemize}
Pasirinktas kompiliatorius - IAR 6.4. Darbo prad\.ejimo metu vienintelis palaik\.e abu maketus, be papildomos \k{i}rangos. 
\subsection{xRM48L950 apra\v{s}as}
 
\subsubsection{Procesorius}
xRM48L950 turi du integruotus 32-bit\k{u} RISC ARM Cortex-R4F procesorius, su slankaus kablelio aritmetikos moduliu. THUMB2 instrukcij\k{u} rinkinys - 16bit\k{u} ir 32bit\k{u} instrukcij\k{u} rinkiniai skirti suma\v{z}inti program\k{u} dyd\k{i}, nel\.etinant procesoriaus darbo. Procesoriai i\v{s}destyti skirtinga orientacija  
\begin{figure}[H] %--< nustatymai kur bus paveiksliukas h - kaip tekste, t - puslapio virsuje, b - puslapio apacioje, H - tiksliai kaip tekste, p - atskiram paveiksleliu pslapy >--%
\centering %--< lygiavimas >--%
\includegraphics[scale=2.5]{pav/orentacija.jpg} %--< scale - dydis, {aplankas/pav.pavadinimas} >--%
\captionsetup{labelformat=numbfirst} %--< pries tai apibrezem kaip turi atrodyti tekstas po paveiksleliu >--%
\captionsetup{labelseparator=tarpas}


\caption{Procesori\k{u} i\v{s}d\.estymas}
\label{vienas}
\end{figure}
Taip pat taktinis da\v{z}nis procesoriams paduodamas su 2 takt\k{u} u\v{z}laikymo skirtumu. 
Procesori\k{u} i\v{s}\.ejimo signalai palyginami atskirame modulyje.
\begin{figure}[H] %--< nustatymai kur bus paveiksliukas h - kaip tekste, t - puslapio virsuje, b - puslapio apacioje, H - tiksliai kaip tekste, p - atskiram paveiksleliu pslapy >--%
\centering %--< lygiavimas >--%
\includegraphics[scale=2.8]{pav/impl.jpg} %--< scale - dydis, {aplankas/pav.pavadinimas} >--%
\captionsetup{labelformat=numbfirst} %--< pries tai apibrezem kaip turi atrodyti tekstas po paveiksleliu >--%
\captionsetup{labelseparator=tarpas}
\caption{Dviej\k{u} branduoli\k{u} \k{i}gyvendinimas}
\label{vienas}
\end{figure}
\k{I}renginys palaiko sav\k{e}s testavim\k{a}. Jo metu galima priversti procesori\k{u} i\v{s}\.ejimo signal\k{u} nesutapim\k{a}, taip patikrinama ar veikia procesori\k{u} palyginimo modulis ir ar \k{i}renginys sugeba atpa\v{z}inti klaidas. Procesoriai maitinami 1.2V \k{i}tampa. 


\subsubsection{Atmintys}
\k{I}renginys palaiko little-endian $($LE32$)$ format\k{a}. Tai rei\v{s}kia, kad atmintyje jauniausias bitas yra saugomas pirmas.
SRAM ir Flash atminys turi ECC\footnote{ECC - error corection code} apsaug\k{a} - galimyb\.e 1 bito klaidos aptikimui ir pataisymui, bei 2 bit\k{u} klaidos aptikimui. Flash atmintis maitinama 3.3V \k{i}tampa. Esant %%pipeline%% 
re\v{z}imui flash atmintis gali veikti iki 200MHz taktiniu da\v{z}niu. SRAM atmint\k{i} galima nuskaityti arba ira\v{s}yti 1 ciklu nepriklausomai nuo re\v{z}imo.   


\subsubsection{Tr\=uki\k{u} sistema}
Vektorinis tr\=uki\k{u} valdiklis \k{i}galina veiksm\k{u} prioritizavim\k{a} ir kontrol\k{e}. Tr\=ukis - tai norimas priverstinis sistemos nukrypimas nuo normalaus darbo. Paprastai toks \k{i}vikis reikalauja greito procesoriaus atsako. Procesorius i\v{s} normalios programos per\v{s}oka \k{i} tr\=ukio aptarnavimo paprogram\k{e}. RM48 palaiko 96 skirtingus programi\v{s}kai reguliuojamo prioriteto tr\=ukius. Yra 2 tr\=ukio vektoriai - normal\=us tr\=ukiai $($IRQ\footnote{IRQ - interrupt request}$)$ ir greitieji tr\=ukiai $($FIQ\footnote{FIQ - fast interrupt request}$)$. Greitieji tr\=ukiai turi didesni prioriteta u\v{z} normalius ir yra nemaskuojami t.y. juos \k{i}jungus j\k{u} neimanoma i\v{s}jungti ar pakeisti, nebent atlikus sistemos perkrovima, kai visi tr\=ukiai yra automati\v{s}kai i\v{s}jungiami. Greitieji tr\=ukiai gali pertraukti normalius.  


\subsubsection{Prievadai}
RM48L950 turi 2 laikma\v{c}i\k{u} $($N2HET\footnote{N2HET - next generation high end timer}$)$ koprocesorius su tiesiogine magistrales prieiga $($DMA$)$ realaus laiko kontrolei. J\k{u} pagalba galima generuoti skirtingo plo\v{c}io impulsus $($PWM$)$, steb\.eti i\v{s}vado login\k{i} lyg\k{i}, bei gali veikti kaip \k{i}vesties/i\v{s}vesties periferija. Taipat yra du 12 bit\k{u} rezoliucijos analogas-skaitmeninis keitikliai su i\v{s}viso 24 kanalais. Prievadai maitinami 3.3V \k{i}tampa. Taipat yra bendrosios paskirties \k{i}vesties i\v{v}esties prievadai.
Palaiko \v{s}ias periferijas:
\begin{itemize}
\item USB
\item Ethernet
\item UART
\item $I^2C$
\item SCI
\item DCAN
\end{itemize}



\subsection{STM32F4 apra\v{s}as}


\subsubsection{Procesorius}
ARM Cortex-M4F 32-bit\k{u} RISC procesorius, su slankaus kablelio aritmetikos moduliu. Palaiko DSP instrukcijas ir 32bit\k{u} slankaus kablelio duomenis.      


\subsubsection{Atmintys}
Adaptyvus realaus laiko atminties greitintuvas leid\v{z}ia minimal\k{u} procesoriaus laukim\k{a} esant dideliems taktavimo da\v{z}niams nuskaitant ir \k{i}ra\v{s}ant \k{i} Flash atmint\k{i}. SRAM atmintis nuskaitom ir \k{i}ra\v{s}oma 1 taktinio da\v{z}nio grei\v{c}iu. Atminties apsaugos modulis riboja procesoriaus pri\.ejim\k{a} prie atminties, kad b\=ut\k{u} galima i\v{s}vengti nety\v{c}ini\k{u} atminties sugadinim\k{u}. Tai ypa\v{c} praver\v{c}ia kai turima kriti\v{s}kai svarbi\k{u} duomen\k{u} ir juos reikia apsaugoti nuo kit\k{u} veikian\v{c}i\k{u} proces\k{u}. Pavyzd\v{z}iui, jeigu yra veikianti operacin\.e sistema procesoriuje.


\subsubsection{Tr\=uki\k{u} sistema}
Palaiko \k{i}d\.etin\k{e} vektorin\k{e} tr\=uki\k{u} kontrol\k{e} $($NVIC\footnote{NVIC - nested vectored interrupt controller}$)$.
Yra 16 prioritet\k{u} lygi\k{u}, 82 maskuojami tr\=uki\k{u} kanalai. Leid\v{z}ia auk\v{s}tesnio prioriteto tr\=ukiams pertraukti vykdomus \v{z}emesnio prioriteto tr\=ukius, minimaliai apkraunant procesori\k{u}. 


\subsubsection{Prievadai}    
140 \k{i}\.ejimo i\v{s}\.ejimo bendrosios paskirties prievad\k{u}, su tr\=ukio generavimo galimybe. Periferijos greitis - iki 84MHz. Du 12 bit\k{u} skaitmeninis analogas keitikliai. Trys 12 bit\k{u} analogas skaitmeninis keitikliai su i\v{s}viso 24 kanalais. 
Palaikomos periferijos:
\begin{itemize}
\item $I^2C$
\item UART
\item $I^2S$
\item CAN
\item USB 2.0
\item Ethernet
\end{itemize}

\newpage %perkelia testa i nauja lapa

\section{Naudoti testavimo algoritmai ir j\k{u} apra\v{s}ai}
%\addcontentsline{toc}{section}{Praktin\.{e}\ dalis} % prideda
\subsection{Matematini\k{u} funkcij\k{u} skai\v{c}iavimo grei\v{c}i\k{u} \k{i}vertinimo algoritmai}
\v{S}iame paragrafe apra\v{s}ytiems algoritmams buvo naudojamas laiko tr\=ukis, kurio pagalba buvo ska\v{c}iuojamas algoritmo atlikimo greitis 1ms tikslumu. Abu maketai buvo nustatyti veikti 100MHz grei\v{c}iu. Algoritmai buvo leisti 100 kart\k{u} ir paskai\v{c}iuotas laikas suvidurkintas.
\subsubsection{Slankaus kablelio algoritmai}
Slankaus kablelio Gauss Legendre algoritmas $\pi$ skai\v{c}iavimui:
\begin{equation*}\label{xx}
a_{0}=1\;b_{0}=\frac{1}{\sqrt{2}}\;t_{0}=\frac{1}{4}\;p_{0}=1\\
\end{equation*}
\begin{equation*}
a_{n+1} = \frac{a_n + b_n}{2},
\end{equation*}
\begin{equation*}
b_{n+1} = \sqrt{a_n b_n}, 
\end{equation*}
\begin{equation*}
t_{n+1} = t_n - p_n(a_n - a_{n+1})^2, 
\end{equation*}
\begin{equation*}
p_{n+1} = 2p_n. 
\end{equation*}
\begin{equation}
\pi \approx \frac{(a_n+b_n)^2}{4t_n}
\end{equation}
Naudojant dvigubo tikslumo kintam\k{u}j\k{u} test\k{a} buvo ie\v{s}komas 1000 narys, suskai\v{c}iuota  
konstanta nuo pasirinktosios skiriasi $3.55271 * 10^{-15}$. 
%\textcolor{gray}{\\
\begin{verbatim}
  int doubleTest() { 
    volatile int i; 
    volatile double an,bn,tn,pi; 
    volatile double a,b,t,p;  
    a = 1.0; b = 1/sqrt(2); 
    t = 1/4; p = 1.0; 
    for (i = 0; i < 1000; i++) { 
      an = (a+b)/2;  
      bn = sqrt(a*b); 
      tn = t - p*(a-an)*(a-an);  
      p *= 2; 
      pi = (an+bn)*(an+bn)/(4*tn);  
      a = an; b = bn; t = tn; 
    }
    if ((pi - 3.14159265358979) <= 3.55271e-15) 
      return 1; //testas atliktas sekmingai
    return 0;  //teste ivyko klaida
  } 
\end{verbatim}
%}
Naudojant viengubo tikslumo slankaus kablelio kintamuosius buvo ie\v{s}komas 120 narys. Konstanta nuo pasirinktosios skiriasi $8.74228* 10^{-8}$
\begin{verbatim}
int floatTest() {
  volatile int i;
  volatile float an,bn,tn,pi;
  volatile float a,b,t,p;
  for(volatile int j = 0; j <9; j++) {
    a = 1.0; b = sqrt(0.5);
    t = 0.25; p = 1.0;
    for (i = 0; i < 120; i++) {
      an = (a+b)/2;
      bn = sqrt(a*b);
      tn = t - (p*(a-an)*(a-an));
      p *= 2;
      pi = (an+bn)*(an+bn)/(4*tn);
      a = an; b = bn; t = tn;
    } 
  }
  if ((pi - 3.14159265358979) <= 8.74228e-8)
    return 1; //testas atliktas sekmingai
  return 0; //teste ivyko klaida
}
\end{verbatim}
\subsubsection{Neslankaus kablelio algoritmas}
Fiksuoto tikslumo algoritmas:
\begin{equation}
b = \sum_{i=0}^{100000} (i * (-1)^{i+1})
\end{equation}

\begin{verbatim}
void intTest() {
  volatile int a,b;
  a = 1;
  b = 0;
  for(volatile int i = 0; i < 100000; i++) {
    b += i * a;
    a *= -1;
  }
}
\end{verbatim}
\subsubsection{Logini\k{u} funkcij\k{u} testavimo algoritmas}
Mikrovaldikliai atlieka logines AND, NOT, OR, XOR, bei bit\k{u} stumdymo funkcijas. 
\begin{verbatim}
short testBits() {
  volatile unsigned sum = 0x55555555; 
  // 0101 0101  0101 0101  0101 0101  0101 0101  
  for (volatile int i = 0; i < 0x020000; i++) {
    sum = sum << 1;          /// sum = 0xAAAAAAAA 
    sum &= 0x0000FFFF;       /// sum = 0x0000AAAA
    sum ^= 0xFFFFFFFF;       /// sum = 0xFFFF5555
    sum = sum << 16;         /// sum = 0x55550000
    sum = sum | (sum >> 16); /// sum = 0X55555555
    sum = ~sum;              /// sum = 0xAAAAAAAA
    sum = sum >> 1;          /// sum = 0x55555555
  }
  if (0x55555555 == sum)
    return 1; //testas ivykditas sekmingai
  return 0; // teste ivyko klaida
}
\end{verbatim}
\subsubsection{Greitas disckretinis Furj\.e\ eilut\.es transformavimo testas}
Naudotos arm dsp\footnote{Dsp - digital signal processing $($skaitmeninis signal\k{u} apdorojimas$)$} bibliotekos, atskirai optimizuotos R4 bei M4 mikrovaldikliams. Naudota 1024 kompleksini\k{u} ta\v{s}k\k{u}, kurie masyve i\v{s}d\.estyti vienas po kito ir bendras masyvo ilgis 2048. Slankaus kablelio testui masyvas u\v{z}pildomas funkcija:
\begin{equation*}
Re(z) = (sin(v*i) + cos(v*7)),\; t = 0, 2, 4... 2046
\end{equation*}
\begin{equation}
Im(z) = 0
\end{equation}
\begin{verbatim}
#define TEST_LENGTH_SAMPLES 2048 
static float32_t testInput[TEST_LENGTH_SAMPLES]; 
static float32_t testOutput[TEST_LENGTH_SAMPLES/2]; 
uint32_t fftSize = 1024; 
uint32_t ifftFlag = 0; 
uint32_t doBitReverse = 1; 

void prepareTestFloat(void) {
  for(volatile int t = 0; t < 2048; t+=2) {
    testInput[i] = sin(t*3) + cos(t*7);
    testInput[i+1] = 0;
  }
}

int32_t testCfftFloat(void) { 
  arm_status status; 
  arm_cfft_radix4_instance_f32 S; 
  float32_t maxValue;  
   
  arm_cfft_radix4_init_f32(&S, fftSize, ifftFlag, doBitReverse); 
   
  arm_cfft_radix4_f32(&S, testInput); 
   
  arm_cmplx_mag_f32(testInput, testOutput, fftSize);  
   
  arm_max_f32(testOutput, fftSize, &maxValue, &testIndex); 
   
  if(testIndex == refIndex) { 
    return 1;
  }
  return 0;
} 
\end{verbatim}  
Fiksuoto tikslumo Furij\.e transformacijai naudoti ARM Q31 fiksuoto kablelio kintamieji. I\v{s} slankaus kablelio paversti \k{i} Q31 naudota funkcija:
\begin{equation}
Q31(x)= ((int)\; ((x)*(float)(1<<31))\; )
\end{equation}   
Masyvo u\v{z}pildo funkcija:
\begin{equation*}
Re(z) = Q31(1000*(sin(v*i) + cos(v*7)))),\; t = 0, 2, 4... 2046
\end{equation*}
\begin{equation}
Im(z) = 0
\end{equation}
\begin{verbatim}
#define TEST_LENGTH_SAMPLES 2048
uint32_t fftSize = 1024; 
uint32_t ifftFlag = 0; 
uint32_t doBitReverse = 1; 
static q31_t testInputQ[TEST_LENGTH_SAMPLES]; 
static q31_t testOutputQ[TEST_LENGTH_SAMPLES/2]; 
uint32_t refQIndex = 0;

void prepareTestQ31(void) {
  double skaicius=0;
  int nulis = (int) ((0 * (float)(1<<31)));
  for(volatile int32_t i = 0; i < 2048; i+=2) {
    skaicius = 1000*sin(i*3) + 1000*cos(i*7);
    testInputQ[i] = ((int)(skaicius * (float)(1<<31)));
    testInputQ[i+1] = nulis;
  }
}

int32_t testCfftQ31(void) { 
  arm_status status; 
  arm_cfft_radix4_instance_q31 S; 
  q31_t maxValue; 
   
  status = arm_cfft_radix4_init_q31(&S, fftSize, ifftFlag, doBitReverse); 
   
  arm_cfft_radix4_q31(&S, testInputQ); 
  
  arm_cmplx_mag_q31(testInputQ, testOutputQ, fftSize);  
 
  arm_max_q31(testOutputQ, fftSize, &maxValue, &testIndex); 

  if(testIndex == refIndex) { 
    return 1;
  } 
  return 0;
}
\end{verbatim}
\subsection{\k{I}\.ejimo ir i\v{s}\.ejimo \k{i} tr\=uk\k{i} algoritmo apra\v{s}ymas}
Naudojami maketai buvo paleisti veikti 100MHz grei\v{c}iu. Abu maketai keisdavo i\v{s}\.ejimo porto vienos kojos login\k{i} lyg\k{i}, bei buvo \k{i}jungtas nuo laiko priklausantis tu\v{s}\v{c}ias tr\=ukis. Osciloscopu matuota port\k{u} i\v{s}vad\k{u} lygmen\k{u} kitimo laikas.
\subsection{Srov\.es matavimai}
STM32F4DISCOVERY makete srov\.e matuota tiesiogiai multimetru 
tarp mikrovaldiklio ir srov\.es stabilizatoriaus. . TMDXRM48USB maketas netur\.ejo 
trumpikli\k{u} tarp srov\.es stabilizatoriaus ir mikrovaldiklio. Tarp stabilizatoriau 3.3V i\v{s}\.ejimo ir mikrovaldiklio i\v{s}vad\k{u} maitinimo bei stabilizatoriaus 1.2V i\v{s}\.ejimo ir mikrovaldiklio logikos maitinimo buvo \k{i}terptos 0.12$\Omega$ var\v{z}os. Vis\k{u} matavim\k{u} metu 
  i\v{s}vadai buvo nustatyti i\v{s}vesties re\v{z}ime ir 
  nustatyti nuliniame loginiame lygije. Buvo atlikti matavimai
  esant \v{s}iom konfig\={u}racijomis:
\begin{itemize}
\item \k{i}jungtas "stanby" re\v{z}imas:
\begin{itemize} 
\item Cortex-R4:
\begin{itemize}
\item i\v{s}jungta Flash atmintis
\item procesoriai neatlieka joki\k{u} skai\v{c}iavim\k{u}
\end{itemize}

\item Cortex-M4:
\begin{itemize}
\item vidinis 1.2V \k{i}tampos reguliatorius i\v{s}jungtas
\item u\v{z}rakintos faz\.es ciklo $($pll$)$, vidinis 16MHz ir i\v{s}orinis 8MHz taktiniai osciliatoriai atjungti. Veikia vidinis 32kHz taktinis osciliatorius
\item procesorius sustabdytas
\item mikrovaldiklis minimalioje srov\.es suvartojimo b\=usenoje.
\item re\v{z}im\k{a} galima i\v{s}eiti:
\begin{itemize} 
\item gavus i\v{s}orin\k{i} impuls\k{a} \k{i} NRST arba WKUP i\v{s}vadus 
\item realaus laiko laikrod\v{z}iui $($RTC$)$ sugeneravus tr\=uk\k{i}
\end{itemize} 
\end{itemize}
\end{itemize}
\item \k{i}jungtas negilaus miego re\v{z}imas esant \k{i}vairiems taktavimo grei\v{c}iams:
\begin{itemize} %aprasyti sleep modey
\item Cortex-R4:
\begin{itemize}
\item sistema veikia taktavimo da\v{z}niu
\item procesorius neatlieka skai\v{c}iavim\k{u}
\end{itemize}
\item Cortex-M4:
\begin{itemize}
\item sistema veikia u\v{z}rakintos faz\.es ciklo taktavimo da\v{z}niu
\item procesorius sustabdytas $($CPU$)$
\item i\v{s} re\v{z}imo galima i\v{s}eiti betkokio tr\=ukio pagalba
\end{itemize}
\end{itemize}
\item esant skirtingiems taktavimo da\v{z}niams mikrovaldikliai atlikin\.ejo slankaus kablelio, neslankaus kablelio aritmetikos testus, bei buvo paleisti veikti cikle: \begin{verbatim} while(1); \end{verbatim} 
\end{itemize}

\newpage
   
\section{Rezultatai}
Cortex-R4 mikrovaldiklis beveik visus skai\v{c}iavimo testus atliko grei\v{c}iau nei cortex-M4 mikrovaldikl\k{i} esant 100MHz taktiniui da\v{z}niui. 
\begin{figure}[H] %--< nustatymai kur bus paveiksliukas h - kaip tekste, t - puslapio virsuje, b - puslapio apacioje, H - tiksliai kaip tekste, p - atskiram paveiksleliu pslapy >--%
\centering %--< lygiavimas >--%
\includegraphics[scale=0.8]{pav/testai.jpg} %--< scale - dydis, {aplankas/pav.pavadinimas} >--%
\captionsetup{labelformat=numbfirst} %--< pries tai apibrezem kaip turi atrodyti tekstas po paveiksleliu >--%
\captionsetup{labelseparator=tarpas}
\caption{Skai\v{c}iavimo algoritm\k{u} laikai. 1 - dvigubo tikslumo slankaus kablelio testas. 2 - slankaus kablelio testas. 3 - neslankaus kablelio testas. 4 - logini\k{u} funkcij\k{u} testas. 5 - Furij\.e slankaus kablelio. 6 - Furij\.e neslankaus kablelio.}
\label{vienas}
\end{figure}
Cortex-R4 generavo 280ns ilgio impulsus. \k{I}\.ejimo \k{i} tr\=uk\k{i} ir i\v{s}\.ejimo laikas 730ns. Cortex-M4 generavo 150ns ilgio impulsus. \k{I}\.ejimo \k{i} tr\=uk\k{i} ir i\v{s}\.ejimo laikas 200ns.
\begin{figure}[H] %--< nustatymai kur bus paveiksliukas h - kaip tekste, t - puslapio virsuje, b - puslapio apacioje, H - tiksliai kaip tekste, p - atskiram paveiksleliu pslapy >--%
\centering %--< lygiavimas >--%
\includegraphics[scale=0.4]{pav/trukiai.jpg} %--< scale - dydis, {aplankas/pav.pavadinimas} >--%
\captionsetup{labelformat=numbfirst} %--< pries tai apibrezem kaip turi atrodyti tekstas po paveiksleliu >--%
\captionsetup{labelseparator=tarpas}
\caption{Generuot\k{u} impuls\k{u} laikin\.e diagrama.}
\label{vienas}
\end{figure}
Mikrovaldiklio Cortex-R4 \v{s}erdis maitinama 1.2V, periferijos 3.3V.Naudojama galia $P=I_{\v{s}erdies} *1.2V + I_{periferijos} * 3.3V$  .Cortex-M4 maitinamas 3.3V, galia $P=I*3.3V$.
\begin{figure}[H] %--< nustatymai kur bus paveiksliukas h - kaip tekste, t - puslapio virsuje, b - puslapio apacioje, H - tiksliai kaip tekste, p - atskiram paveiksleliu pslapy >--%
\centering %--< lygiavimas >--%
\includegraphics[scale=0.8]{pav/modes.jpg} %--< scale - dydis, {aplankas/pav.pavadinimas} >--%
\captionsetup{labelformat=numbfirst} %--< pries tai apibrezem kaip turi atrodyti tekstas po paveiksleliu >--%
\captionsetup{labelseparator=tarpas}
\caption{Mikrovaldikliai stanby re\v{z}ime.}
\label{vienas}
\end{figure}
\begin{figure}[H] %--< nustatymai kur bus paveiksliukas h - kaip tekste, t - puslapio virsuje, b - puslapio apacioje, H - tiksliai kaip tekste, p - atskiram paveiksleliu pslapy >--%
\centering %--< lygiavimas >--%
\includegraphics[scale=0.8]{pav/sleep.jpg} %--< scale - dydis, {aplankas/pav.pavadinimas} >--%
\captionsetup{labelformat=numbfirst} %--< pries tai apibrezem kaip turi atrodyti tekstas po paveiksleliu >--%
\captionsetup{labelseparator=tarpas}
\caption{Mikrovaldikli\k{u} galios vartojimo priklausomyb\.e nuo taktinio grei\v{c}io sleep re\v{z}ime.}
\label{vienas}
\end{figure}
\begin{figure}[H] %--< nustatymai kur bus paveiksliukas h - kaip tekste, t - puslapio virsuje, b - puslapio apacioje, H - tiksliai kaip tekste, p - atskiram paveiksleliu pslapy >--%
\centering %--< lygiavimas >--%
\includegraphics[scale=0.8]{pav/R4galia.jpg} %--< scale - dydis, {aplankas/pav.pavadinimas} >--%
\captionsetup{labelformat=numbfirst} %--< pries tai apibrezem kaip turi atrodyti tekstas po paveiksleliu >--%
\captionsetup{labelseparator=tarpas}
\caption{RM48 mikrovaldiklio naudojamos galios priklausomyb\.e nuo taktinio da\v{z}nio atliekant slankaus kablelio, neslankaus kablelio ir b\=unant tu\v{s}\v{c}iame cikle.}
\label{vienas}
\end{figure}
\begin{figure}[H] %--< nustatymai kur bus paveiksliukas h - kaip tekste, t - puslapio virsuje, b - puslapio apacioje, H - tiksliai kaip tekste, p - atskiram paveiksleliu pslapy >--%
\centering %--< lygiavimas >--%
\includegraphics[scale=0.8]{pav/M4galia.jpg} %--< scale - dydis, {aplankas/pav.pavadinimas} >--%
\captionsetup{labelformat=numbfirst} %--< pries tai apibrezem kaip turi atrodyti tekstas po paveiksleliu >--%
\captionsetup{labelseparator=tarpas}
\caption{STM32F4 mikrovaldiklio naudojamos galios priklausomyb\.e nuo taktinio da\v{z}nio atliekant slankaus kablelio, neslankaus kablelio ir b\=unant tu\v{s}\v{c}iame cikle.}
\label{vienas}
\end{figure}

\newpage
\section{I\v{s}vados}


\begin{enumerate}
\item Atliekant skai\v{c}iavimus Cortex-R4 yra prana\v{e}snis
\item Cortex-R4 turi tik du tr\=ukio re\v{z}imus ir \k{i}\.ejimo bei i\v{s}\.ejimo laikai stipriai atsilieka nuo M4, tod\.el jis labiau tinkamas naudoti ten kur tr\=uki\k{u} yra nedaug, o juose reikia atlikti daug skai\v{c}iavim\k{u}.
\item Du procesoriai esantys R4 stipriai padidina mikrovaldiklio naudojam\k{a} gali\k{a}
\end{enumerate}

\newpage

%\section{Priedai}

%Bet kokia reikalinga papildoma informacija: paveiksl\.{e}liai, grafikai ir t.t.

%\end{onehalfspacing}

%\newpage

%\section*{Mokslin\.{e}s publikacijos ir konferencij\k{u} prane\v{s}imai}

%\addcontentsline{toc}{section}{Mokslin\.{e}s publikacijos ir konferencij\k{u} prane\v{s}imai}

%\begin{onehalfspacing}

%\v{S}iame skyriuje pateikiamos mokslin\.{e}s publikacijos bei \v{z}odiniai ir stendiniai prane\v{s}imai konferencijose, kurie yra susij\k{e} su "mano darbo pavadinimas".\\

%\begin{center}
%\textbf{Mokslini\k{u} publikacij\k{u}, \k{i}traukt\k{u} \k{i} mokslin\.{e}s informacijos instituto (ISI) pagrindini\k{u} \v{z}urnal\k{u} duomen\k{u} baz\k{e}, s\k{a}rašas\\}
%\end{center}

%1. 

%2. 

%\newpage

%\begin{center}
%\textbf{Kitos mokslin\.{e}s publikacijos\\}
%\end{center}

%1. 

%2. 

%\begin{center}
%\textbf{\v{Z}odiniai prane\v{s}imai konferencijose}\\
%\end{center}

%1. 

%2. 

%\begin{center}
%\textbf{Stendiniai prane\v{s}imai konferencijose}\\
%\end{center}

%1. 

%2. 


%\end{onehalfspacing}

%\newpage

%%-----====literaturos sarasas====------%%
\section*{Literat\={u}ros s\k{a}ra\v{s}as}
\addcontentsline{toc}{section}{Literat\={u}ros s\k{a}ra\v{s}as}
\begin{enumerate}
\item  Q formatai ir konvertavimas. \begin{verbatim}http://infocenter.arm.com/help/topic/com.arm.doc.dai0033a/
DAI0033A_fixedpoint_appsnote.pdf\end{verbatim}
\item TMDXRM48USB trumpas apra\v{s}as. \begin{verbatim}http://processors.wiki.ti.com/images/5/5c/RM48_USB_QUICK_START.pdf\end{verbatim}
\item Detalus Cortex-R4 apra\v{s}as. \begin{verbatim}http://www.ti.com/lit/ds/spns177a/spns177a.pdf\end{verbatim}
\item Cortex-R4 energijos vartojimo optimizavimo apra\v{s}as.\begin{verbatim} http://www.ti.com/lit/an/spna172a/spna172a.pdf\end{verbatim}
\item Cortex-R4 slankaus kablelio modulio savybi\k{u} apra\v{s}as. \begin{verbatim}http://infocenter.arm.com/help/index.jsp?topic=/
com.arm.doc.dai0240a/index.html\end{verbatim}
\item STM32F4-Discovery trumpas apra\v{s}as. \begin{verbatim}http://www.st.com/internet/com/TECHNICAL_RESOURCES/
TECHNICAL_LITERATURE/DATA_BRIEF/DM00037955.pdf\end{verbatim}
\item Detalus Cortex-M4 mikrovaldiklio apra\v{s}as. \begin{verbatim}http://www.st.com/internet/com/TECHNICAL_RESOURCES/TECHNICAL_LITERATURE/
DATASHEET/DM00037051.pdf\end{verbatim}
\item Cortex-M4 slankaus kablelio modulio sovybi\k{u} apra\v{s}as. \begin{verbatim}http://www.st.com/internet/com/TECHNICAL_RESOURCES/TECHNICAL_LITERATURE/
DATASHEET/DM00037051.pdf\end{verbatim}
\item $\pi$ skai\v{c}iavimo algoritmas. \begin{verbatim}http://en.wikipedia.org/wiki/Gauss-Legendre_algorithm\end{verbatim}
\end{enumerate}

%\bibliography{Kursinis.bbl} %--< skliausteliuose turi buti nurodamas literaturos saraso failo pavadinimas >--%
%\bibliographystyle{nature} %--< literaturos stilius >--%

%\newpage

%\section*{Santrauka}


%\addcontentsline{toc}{section}{Santrauka}

%\begin{onehalfspacing}

%\begin{center}

%\studentas \\[12pt]

%\MakeUppercase{,,\pavadinimas''}\\

%\end{center}

%Tekstas

%\newpage

%\section*{Summary}

%\addcontentsline{toc}{section}{Summary}

%\begin{center}

%\studentas \\[12pt]

%\MakeUppercase{,,Title''}\\


%\end{center}

%Text

\end{onehalfspacing}


\end{document} 
