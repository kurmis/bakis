\documentclass[a4paper, 12pt]{article} %--< dokumento nustatymai >--%
%\usepackage[T1]{fontenc} %--< reikia kuomet norima naudoti komanda \k{a} - a raide bus parasyta su nosine >--%
\usepackage{graphicx} %--< reikalinga paveiksliuku ikelimui >--%
\usepackage[left=1.18in,top=0.79in,right=0.39in,bottom=0.79in]{geometry} %--< parasciu nustatymai >--%
\usepackage{color} %--< spalvoto srifto nustatymai >--%
\usepackage{xcolor}
\usepackage{setspace} %--< setspace.sty failas turi buti toje pacioje direktorijoje kaip ir winedt failas >--%
\usepackage{caption} %--< leidzia rasyti komentarus po objektais >--%
\usepackage{cite} %-< reikalinga citavimui >--%
\usepackage{verbatim} %--< leidzia naudoti \begin{comment}...\end{comment} funkcijas>--%

\usepackage[utf8]{inputenc} %--< kad butu galima rasyti lietuviskai >--%
\usepackage[L7x]{fontenc}
\usepackage[lithuanian]{babel}
\usepackage{lmodern}

%\usepackage[english]{babel}
\usepackage{array}
\usepackage[titles]{tocloft}
\usepackage{amsmath} %--< formuliu rasymui >--%
\usepackage{indentfirst} %--< pirmas paragrafas prasideda su tab'u >--%
\usepackage{enumitem} %--< tarpu tarp eiluciu sarase redagavimui >--%
%\usepackage{numline} %--< eiluciu numeravimas, sio paketo naudojimas panaikina section pavadinimus >--%
\usepackage{xfrac}
\usepackage{float}
\usepackage{array}
\usepackage{multirow}
\usepackage[]{SIunits}


\makeatletter
\let\c@lofdepth\relax
\let\c@lotdepth\relax
\makeatother
\usepackage{subfigure}
%\usepackage{biblatex}

\setlength{\cftaftertoctitleskip}{-10pt}
\setlength{\cftbeforetoctitleskip}{-10pt}
%\setlength{\parskip}{6pt} %--< kiek tekstas nutoles nuo paragrafo pavadinimo >--%
\parindent=36pt %--< tab'o dydis 1 inch = 72 pt >--%

%-----------< kaip atrodo paveiksleliu ir lenteliu tesktas >-----------------%
\DeclareCaptionLabelFormat{numbfirst}{#2\bothIfSecond{\nobreakspace}{pav}} % -< paveiksliukai vadinami "pav" >- %
\DeclareCaptionLabelFormat{numbtwo}{#2\bothIfSecond{\nobreakspace}{lentel\.{e}}} % -< lenteles vadinamos "lentele" >- %
\DeclareCaptionLabelSeparator{tarpas}{. } % -< po pav taskas ir tarpas >- %
\captionsetup{justification=centering, font=normalsize, labelfont={}, textfont={it}}



%-----------------------------< keletas naudingu komandu >------------------------------------------%
\begin{comment}

-----< Lietuviskos raides, jei neveikia rasymas lietuviskai >--------
\k{a} = ą
\v{z} = ž
\v{s} = š
\.{e} = ė 
\k{e} = ę
\={u} = ū
\k{u} = ų
\k{i} = į
\v{c} = č
----------------------------------------

\textbf{padaro teksta bold}
\textit{Padaro teksta italic}
%\cite{ka cituojam}
\newpage naujas puslapis

Jei norim tekste formuliu rasom ja tarp $formule$, jei numeruotai, tai pagal
\begin{equation}
formule
label{formules_label}
\end{equation}
ir naudojam formules citavimui \ref{formule_label}

\noindent pritaukia eilute prie krasto

-------< paveiksliukams patogu susikurti atskira folderi takim paveiksliukai ar pav >--------
-------< vienas paveiksliukas >---------
\begin{figure}[H] %--< nustatymai kur bus paveiksliukas h - kaip tekste, t - puslapio virsuje, b - puslapio apacioje, H - tiksliai kaip tekste, p - atskiram paveiksleliu pslapy >--%
\centering %--< lygiavimas >--%
\includegraphics[scale=0.44]{pav/SPP_dispersijos_kreive} %--< scale - dydis, {aplankas/pav.pavadinimas} >--%
\captionsetup{labelformat=numbfirst} %--< pries tai apibrezem kaip turi atrodyti tekstas po paveiksleliu >--%
 \captionsetup{labelseparator=tarpas}
 \caption{Tesktas po paveiksleliu}
 \label{vienas}
 \end{figure}

-------< du paveiksliukai ir t.t. >---------
\begin{figure}[h]
\centering
\subfigure[]{ %--< pirmas paveiksliukas, jei [] tusti tai numeruojama raidemis >--%
\includegraphics[scale=0.3]{pav/pirmas}
\label{pirmas}
}
\centering
\subfigure[]{ %--< antras paveiksliukas >--%
\includegraphics[scale=0.27]{antras}
 \label{antras}
 }
\captionsetup{labelformat=numbfirst}
\captionsetup{labelseparator=tarpas}
\caption{Kas paveikslikuose (a) ir (b), tesktas po paveiksliuku}
\label{dupaveiksliukai}
\end{figure}

----------< numeruojam teksta >-------
\begin{enumerate}[itemsep=12pt, parsep=-10pt]
 \item[a)]  %--< jei [] nieko arba be [], tai numeruos skaiciais
\item[b)] 
\item[c)]      
\end{enumerate}

\end{comment}

%=================================================================%
%--< dalis kuria reikia uzpildyti, bet tam tikrais atvejais gali tekti pagal poreikius paredaguoti title.tex faila >--%
%=================================================================%

\newcommand{\studentas}{Mindaugas Kurmauskas} %--< cia irasyti savo varda pavarde (toliau kitus duomenis) ir nebereikes tekste >--%
\newcommand{\vadovas}{dr. Mindaugas Vil\={u}nas}
\newcommand{\recenzentas}{dr. Recenzentas}
\newcommand{\vedejas}{dr.(HP) K\k{e}stutis Arlauskas}
\newcommand{\pavadinimas}{Cortex R4 mikrovaldiklio architekt\={u}ros tyrimas} %--< cia irasyti darbo pavadinima >--%

\newcommand{\katedra}{\kkek} %--< irasyti savo, nebutinai komanda >--%
%=======%
\newcommand{\kkek}{Kieto k\={u}no elektronikos katedra}
\newcommand{\kek}{Kvantin\.{e}s elektronikos katedra}
\newcommand{\pfk}{Puslaidininki\k{u} fizikos katedra}
\newcommand{\rfk}{Radiofizikos katedra}
\newcommand{\tfk}{Teorin\.{e}s fizikos katedra}
\newcommand{\bfsk}{Bendrosios fizikos ir spektroskopijos katedra}
%==========%

\newcommand{\darbas}{\bakikurs} %--< irasyti savo >--%
%=========%
\newcommand{\bakikurs}{Pagrindini\k{u} studij\k{u} kursinis darbas}
\newcommand{\bakis}{Pagrindini\k{u} studij\k{u} baigiamasis darbas}
\newcommand{\magikurs}{Magistrant\={u}ros studij\k{u} kursinis darbas}
\newcommand{\magis}{Magistrant\={u}ros studij\k{u} baigiamasis darbas}
%==========%

\newcommand{\studprog}{\tf} %--< irasyti savo, nebutinai komanda >--%
%==========%
%--< besimokantiems fizfake studiju programos >--%
\newcommand{\fiz}{Fizika}
\newcommand{\tf}{Taikomoji fizika}
\newcommand{\tfe}{Telekomunikacij\={u} fizika ir elektronika}
\newcommand{\kf}{Kompiuterin\.{e} fizika}
\newcommand{\mtfv}{Moderni\k{u}j\k{u} technologij\k{u} fizika ir vadyba}
\newcommand{\bef}{Branduolin\.{e}s energetikos fizika}
\newcommand{\apchef}{Aplinkos ir chemin\.{e} fizika}
\newcommand{\bio}{Biofizika}
\newcommand{\laztech}{Lazerin\.{e}s technologijos}
\newcommand{\fiztech}{Fizikin\.{e}s technologijos ir j\k{u} vadyba}
\newcommand{\lazfiz}{Lazerin\.{e} fizika ir optin\.{e}s technologijos}
\newcommand{\mpf}{Med\v{z}iagotyra ir puslaidininki\k{u} fizika}
\newcommand{\optel}{Optoelektronikos med\v{z}iagos ir technologijos}
\newcommand{\tfem}{Telekomunikacij\k{u} fizika ir elektronika}
\newcommand{\tfa}{Teorin\.{e} fizika ir astrofizika}
%=================================================================%
%=================================================================%


%--------------------------------------< nuo cia prasideda dokumento tekstas >-------------------------------------%


\begin{document} % visas tekstas turi buti tarp begin{document} ir end{document} komandu


\input{./title.tex} % itraukiam titulini lapa i visa dokumenta

\newpage

\pagenumbering{arabic}
\setcounter{page}{2} % nuo kurio skaitmens pradeda numeruoti puslapius

%\tocloftpagestyle{abbrv}
\renewcommand{\cftsecleader}{\cftdotfill{\cftdotsep}} % turinio isvaizdos koregavimas

\renewcommand{\multirowsetup}{\centering}

\renewcommand{\contentsname}{Turinys}
\renewcommand\refname{Literat\={u}ros s\k{a}ra\v{s}as} % pakeicia "references" i "literaturos sarasas"
\tableofcontents

\newpage

\begin{onehalfspacing}

\section*{\k{I}vadas} % * nurodo nenumeruoti sitos dalies

\addcontentsline{toc}{section}{\k{I}vadas} % prideda prie turinio

\v{C}ia yra \k{i}vado tekstas!

\begin{enumerate}[itemsep=12pt, parsep=-12pt] %% Jei reikia numeruoti tikslus ir uzdavinius
\item Pirmas
\item Antras
\end{enumerate}
\newpage

\section{Naudojamos \k{i}rangos ir programos}
Naudojamas TMDXRM48USB paleisties rinkinys\footnote{development kit}. Jame yra:
\begin{itemize}
\item Mikrovaldiklis xRM48L950AZWTT:
\begin{itemize}
\item Du 32-bitu ARM Cortex-R4F procesoriai, veikiantys kartu\footnote{lockstep - kartu atlieka tas pa\v{c}ias komandas}
\item 3MB flash, 256kB RAM
\item greitis iki 220MHz
\item neslankaus(32bitu) ir dvigubo tikslumo (64bitu) slankaus kablelio aritmetikos modulis
\end{itemize} 
\item Integruotas XDS100v2 emuliatorius programavimui per usb
\item LED'ai, temperat\=uros sensorius, \v{s}viesos sensorius, akselerometras
\item pro\v{z}ektoriukas
\end{itemize}
Palyginimui naudojamas STM32F4DISCOVERY paleisties rinkinys:
\begin{itemize}
\item mikrovaldiklis STM32F407VGT:
\begin{itemize}
\item 32-bitu ARM Cortex-M4F procesorius
\item 1MB flash, 192 kB RAM 
\item greitis iki 168MHz 
\item neslankaus (32bitu) ir slankaus (32bitu) kablelio aritmetikos modulis
\end{itemize}
\item Integruotas ST-LINK/V2 emuliatorius programavimui per usb
\item LED'ai, akselerometras, skaitmeninis mikrofonas
\item CS43L22- SAK garsui su integruotu D klases garso stiprinimu
\end{itemize}

    

\newpage %perkelia testa i nauja lapa

\section{Naudoti testavimo algoritmai}
%\addcontentsline{toc}{section}{Praktin\.{e}\ dalis} % prideda

\subsection{Slankaus kablelio algoritmai}
Slankaus kablelio Gauss Legendre algoritmas $\pi$ skai\v{c}iavimui:
\begin{equation*}\label{xx}
a_{0}=1\;b_{0}=\frac{1}{\sqrt{2}}\;t_{0}=\frac{1}{4}\;p_{0}=1\\
\end{equation*}
\begin{equation*}
a_{n+1} = \frac{a_n + b_n}{2},
\end{equation*}
\begin{equation*}
b_{n+1} = \sqrt{a_n b_n}, 
\end{equation*}
\begin{equation*}
t_{n+1} = t_n - p_n(a_n - a_{n+1})^2, 
\end{equation*}
\begin{equation*}
p_{n+1} = 2p_n. 
\end{equation*}
\begin{equation}
\pi \approx \frac{(a_n+b_n)^2}{4t_n}
\end{equation}
Naudojant dvigubo tikslumo kintam\k{u}j\k{u} test\k{a} buvo ie\v{s}komas 1000 narys, suskai\v{c}iuota  
konstanta nuo pasirinktosios skiriasi $3.55271 * 10^{-15}$. 
%\textcolor{gray}{\\
\begin{verbatim}
  int doubleTest() { 
    volatile int i; 
    volatile double an,bn,tn,pi; 
    volatile double a,b,t,p;  
    a = 1.0; b = 1/sqrt(2); 
    t = 1/4; p = 1.0; 
    for (i = 0; i < 1000; i++) { 
      an = (a+b)/2;  
      bn = sqrt(a*b); 
      tn = t - p*(a-an)*(a-an);  
      p *= 2; 
      pi = (an+bn)*(an+bn)/(4*tn);  
      a = an; b = bn; t = tn; 
    }
    if ((pi - 3.14159265358979) <= 3.55271e-15) 
      return 1; //testas atliktas sekmingai
    return 0;  //teste ivyko klaida
  } 
\end{verbatim}
%}
Naudojant viengubo tikslumo slankaus kablelio kintamuosius buvo ie\v{s}komas 120 narys. Konstanta nuo pasirinktosios skiriasi $8.74228* 10^{-8}$
\begin{verbatim}
int floatTest() {
  volatile int i;
  volatile float an,bn,tn,pi;
  volatile float a,b,t,p;
  for(volatile int j = 0; j <9; j++) {
    a = 1.0; b = sqrt(0.5);
    t = 0.25; p = 1.0;
    for (i = 0; i < 120; i++) {
      an = (a+b)/2;
      bn = sqrt(a*b);
      tn = t - (p*(a-an)*(a-an));
      p *= 2;
      pi = (an+bn)*(an+bn)/(4*tn);
      a = an; b = bn; t = tn;
    } 
  }
  if ((pi - 3.14159265358979) <= 8.74228e-8)
    return 1; //testas atliktas sekmingai
  return 0; //teste ivyko klaida
}
\end{verbatim}
\subsection{Neslankaus kablelio algoritmas}
Fiksuoto tikslumo algoritmas:
\begin{equation}
b = \sum_{i=0}^{100000} (i * (-1)^{i+1})
\end{equation}

\begin{verbatim}
void intTest() {
  volatile int a,b;
  a = 1;
  b = 0;
  for(volatile int i = 0; i < 100000; i++) {
    b += i * a;
    a *= -1;
  }
}
\end{verbatim}
\subsection{Bitu testavimo algoritmas}
\begin{verbatim}
short test_bits() {
  volatile unsigned sum = 0x55555555; 
  // 0101 0101  0101 0101  0101 0101  0101 0101  
  for (volatile int i = 0; i < 0x020000; i++) {
    sum = sum << 1;          /// sum = 0xAAAAAAAA 
    sum &= 0x0000FFFF;       /// sum = 0x0000AAAA
    sum ^= 0xFFFFFFFF;       /// sum = 0xFFFF5555
    sum = sum << 16;         /// sum = 0x55550000
    sum = sum | (sum >> 16); /// sum = 0X55555555
    sum = ~sum;              /// sum = 0xAAAAAAAA
    sum = sum >> 1;          /// sum = 0x55555555
  }
  if (0x55555555 == sum)
    return 1; //testas ivykditas sekmingai
  return 0; // teste ivyko klaida
}
\end{verbatim}
\subsection{Greitas disckretinis Furj\.e\ eilut\.es transformavimo testas}
Naudotos arm dsp\footnote{Dsp - digital signal processing $($skaitmeninis signal\k{u} apdorojimas$)$} bibliotekos, atskirai optimizuotos R4 bei M4 mikrovaldikliams. Naudota 1024 kompleksini\k{u} ta\v{s}k\k{u}, kurie masyve i\v{s}d\.estyti vienas po kito ir bendras masyvo ilgis 2048. Slankaus kablelio testui masyvas u\v{z}pildomas funkcija:
\begin{equation*}
Re(z) = (sin(v*i) + cos(v*7)),\; t = 0, 2, 4... 2046
\end{equation*}
\begin{equation}
Im(z) = 0
\end{equation}
\begin{verbatim}
#define TEST_LENGTH_SAMPLES 2048 
static float32_t testInput[TEST_LENGTH_SAMPLES]; 
static float32_t testOutput[TEST_LENGTH_SAMPLES/2]; 
uint32_t fftSize = 1024; 
uint32_t ifftFlag = 0; 
uint32_t doBitReverse = 1; 

void prepareTestFloat(void) {
  for(volatile int t = 0; t < 2048; t+=2) {
    testInput[i] = sin(t*3) + cos(t*7);
    testInput[i+1] = 0;
  }
}

int32_t testCfftFloat(void) { 
  arm_status status; 
  arm_cfft_radix4_instance_f32 S; 
  float32_t maxValue;  
   
  arm_cfft_radix4_init_f32(&S, fftSize, ifftFlag, doBitReverse); 
   
  arm_cfft_radix4_f32(&S, testInput); 
   
  arm_cmplx_mag_f32(testInput, testOutput, fftSize);  
   
  arm_max_f32(testOutput, fftSize, &maxValue, &testIndex); 
   
  if(testIndex == refIndex) { 
    return 1;
  }
  return 0;
} 
\end{verbatim}  
Fiksuoto tikslumo Furij\.e transformacijai naudoti ARM Q31 fiksuoto kablelio kintamieji. I\v{s} slankaus kablelio paversti \k{i} Q31 naudota funkcija\cite{Q31}:
\begin{equation}
Q31(x)= ROUND(2^{31}*10^{x/20})
\end{equation}   
Masyvo u\v{z}pildo funkcija
\begin{equation*}
Re(z) = Q31(1000*(sin(v*i) + cos(v*7)))),\; t = 0, 2, 4... 2046
\end{equation*}
\begin{equation}
Im(z) = 0
\end{equation}
\begin{verbatim}
#define TEST_LENGTH_SAMPLES 2048
uint32_t fftSize = 1024; 
uint32_t ifftFlag = 0; 
uint32_t doBitReverse = 1; 
static q31_t testInputQ[TEST_LENGTH_SAMPLES]; 
static q31_t testOutputQ[TEST_LENGTH_SAMPLES/2]; 
uint32_t refQIndex = 0;

void prepareTestQ31(void) {
  double skaicius=0;
  int nulis = (int)round((pow(2,31)) * pow(10,(0/20)));
  for(volatile int32_t i = 0; i < 2048; i+=2) {
    skaicius = 1000*sin(i*3) + 1000*cos(i*7);
    testInputQ[i] = (int)round((pow(2,31)) * pow(10,(skaicius/20)));;
    testInputQ[i+1] = nulis;
  }
}

int32_t testCfftQ31(void) { 
  arm_status status; 
  arm_cfft_radix4_instance_q31 S; 
  q31_t maxValue; 
   
  status = arm_cfft_radix4_init_q31(&S, fftSize, ifftFlag, doBitReverse); 
   
  arm_cfft_radix4_q31(&S, testInputQ); 
  
  arm_cmplx_mag_q31(testInputQ, testOutputQ, fftSize);  
 
  arm_max_q31(testOutputQ, fftSize, &maxValue, &testIndex); 

  if(testIndex == refIndex) { 
    return 1;
  } 
  return 0;
}
\end{verbatim}
\newpage
   
\section{Rezultatai}
\section{I\v{s}vados}


\begin{enumerate}
\item Pirmas
\item Antras 
\item Tre\v{c}ias
\item Ketvirtas
\end{enumerate}

\newpage

\section{Priedai}

Bet kokia reikalinga papildoma informacija: paveiksl\.{e}liai, grafikai ir t.t.

\end{onehalfspacing}

\newpage

\section*{Mokslin\.{e}s publikacijos ir konferencij\k{u} prane\v{s}imai}

\addcontentsline{toc}{section}{Mokslin\.{e}s publikacijos ir konferencij\k{u} prane\v{s}imai}

\begin{onehalfspacing}

\v{S}iame skyriuje pateikiamos mokslin\.{e}s publikacijos bei \v{z}odiniai ir stendiniai prane\v{s}imai konferencijose, kurie yra susij\k{e} su "mano darbo pavadinimas".\\

\begin{center}
\textbf{Mokslini\k{u} publikacij\k{u}, \k{i}traukt\k{u} \k{i} mokslin\.{e}s informacijos instituto (ISI) pagrindini\k{u} \v{z}urnal\k{u} duomen\k{u} baz\k{e}, s\k{a}rašas\\}
\end{center}

1. 

2. 

\newpage

\begin{center}
\textbf{Kitos mokslin\.{e}s publikacijos\\}
\end{center}

1. 

2. 

\begin{center}
\textbf{\v{Z}odiniai prane\v{s}imai konferencijose}\\
\end{center}

1. 

2. 

\begin{center}
\textbf{Stendiniai prane\v{s}imai konferencijose}\\
\end{center}

1. 

2. 


\end{onehalfspacing}

\newpage

%%-----====literaturos sarasas====------%%

\addcontentsline{toc}{section}{Literat\={u}ros s\k{a}ra\v{s}as}
\bibliography{Kursinis.bbl} %--< skliausteliuose turi buti nurodamas literaturos saraso failo pavadinimas >--%
\bibliographystyle{nature} %--< literaturos stilius >--%

\newpage

\section*{Santrauka}


\addcontentsline{toc}{section}{Santrauka}

\begin{onehalfspacing}

\begin{center}

\studentas \\[12pt]

\MakeUppercase{,,\pavadinimas''}\\

\end{center}

Tekstas

\newpage

\section*{Summary}

\addcontentsline{toc}{section}{Summary}

\begin{center}

\studentas \\[12pt]

\MakeUppercase{,,Title''}\\


\end{center}

Text

\end{onehalfspacing}

\end{document} 